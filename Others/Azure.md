# AZ-104 試験対策：コンピューティングサービス完全攻略ガイド

この記事は、Microsoft Azure Administrator (AZ-104) 認定試験の受験者、特に**初学者**の方を対象に、コンピューティング分野の主要サービスを網羅的に解説した学習資料です。
試験で問われるポイント、勘違いしやすい「引っ掛け」ポイント、そして実務でも役立つ知識を、**見やすく・わかりやすく**整理しています。

---

## 📖 目次

1. [Azure Virtual Machines (VM)](#1-azure-virtual-machines-vm)
2. [Virtual Machine Scale Sets (VMSS)](#2-virtual-machine-scale-sets-vmss)
3. [Azure App Service](#3-azure-app-service)
4. [Azure Container Instances (ACI)](#4-azure-container-instances-aci)
5. [Azure Kubernetes Service (AKS)](#5-azure-kubernetes-service-aks)
6. [Azure Functions](#6-azure-functions)

---

## 1. Azure Virtual Machines (VM)

**Azure Virtual Machines (VM)** は、物理的なサーバーをエミュレート（模倣）した IaaS (Infrastructure as a Service) サービスです。OS（Windows や Linux）から上の管理はユーザーの責任となります。

### ✅ 基本概念と特徴
*   **制御権**: OS レベルまで完全に制御可能（RDP/SSH 接続が可能）。カスタムソフトウェアのインストールも自由。
*   **課金モデル**: 従量課金制（秒単位）。VM を「停止（割り当て解除）」している間は、コンピュート料金は発生しません（ただし、ディスク料金は発生し続けるので注意！）。

> [!IMPORTANT]
> **試験の超重要ポイント：停止と割り当て解除**
> *   **OS内でシャットダウン**：「停止」状態だが、Azure リソースとしては確保されたまま。→ **課金される**。
> *   **Azure Portal で停止**：「停止（割り当て解除）」状態。リソースが解放される。→ **コンピュート料金は課金されない**。
> *   ※試験では「コストを削減するためにどうするか？」という問いで頻出です。「OS内でのシャットダウン」を選ばないように！

### 🛡️ 可用性オプション (Availability Options)
VM の可用性（SLA: Service Level Agreement）を高めるための構成です。**試験の最重要エリア**の一つです。

| オプション | 概要 | SLA (最大) | 障害への耐性 |
| :--- | :--- | :--- | :--- |
| **単一 VM (Premium SSD)** | オプションなしで Premium SSD ストレージを使用 | 99.9% | なし（ハードウェア障害やメンテで停止あり） |
| **可用性セット (Availability Sets)** | データセンター内でラックを分散させる | 99.95% | ラック障害（電源・ネットワーク）など |
| **可用性ゾーン (Availability Zones)** | リージョン内でゾーン（物理的な建物）を分ける | 99.99% | データセンター全体の障害（火災・停電など） |

#### 1. 可用性セット (Availability Sets)
同一データセンター内で、物理的に異なる場所に VM を配置する機能です。以下の2つの要素で構成されます。

*   **障害ドメイン (Fault Domain: FD)**:
    *   電源とネットワークスイッチを共有するグループ（サーバーラック）。
    *   FD を分けることで、1つのラックがダウンしても他の VM は生き残る。
    *   最大 **3** つまで設定可能。
*   **更新ドメイン (Update Domain: UD)**:
    *   メンテナンスや再起動が同時に行われないグループ。
    *   UD が異なれば、同時にメンテナンス再起動されることはない。
    *   最大 **20** まで設定可能。

> [!CAUTION]
> **引っ掛け注意！**
> 可用性セットは「データセンター障害（災害など）」には対抗できません。同じデータセンター内にいるからです。データセンター全滅に備えるなら「可用性ゾーン」が必要です。

#### 2. 可用性ゾーン (Availability Zones)
1つの Azure リージョン（例：東日本）の中に存在する、独立した電源・冷却・ネットワークを持つ物理的なロケーション（建物郡）です。
*   **Zone 1, Zone 2, Zone 3** のように番号で指定して VM を配置します。
*   **ゾーン冗長 (Zone Redundant)**: サービスが自動的にゾーンをまたいで複製されること（VM では手動で配置が必要）。

### 💾 ディスクストレージ
VM にアタッチするディスクには大きく分けて2種類あります。現在は**Managed Disks**が主流です。

1.  **管理ディスク (Managed Disks)**:
    *   Microsoft がバックエンドのストレージアカウントを管理。可用性が高く、管理が楽。**基本はこちらを選ぶ。**
2.  **非管理ディスク (Unmanaged Disks)**:
    *   ユーザーが自分でストレージアカウントを作成・管理が必要。古い仕様。

#### ディスクの種類 (SKU)
パフォーマンス要件に応じて選択します。

*   **Ultra Disk**: 最速。ミリ秒未満のレイテンシ。IOPS とスループットを動的に変更可能。
*   **Premium SSD**: 本番環境向け。高い IOPS とスループット。SLA 対象。
*   **Standard SSD**: 安価な開発・テスト、Web サーバー向け。
*   **Standard HDD**: バックアップやアクセスの少ないデータ向け。

> [!TIP]
> **試験対策**：
> 「SLA 99.9% (単一VM) を達成するための最小要件は？」と聞かれたら、**Premium SSD** 以上が必須です。Standard HDD では単一 VM の SLA は提供されません。

### 🌐 ネットワーク構成
VM には直接 IP アドレスが付くわけではなく、**ネットワークインターフェース (NIC)** がアタッチされます。
*   **パブリック IP**: インターネットから接続する場合に必要。
*   **プライベート IP**: 仮想ネットワーク (VNet) 内での通信用。
*   **NSG (Network Security Group)**: ファイアウォールのようなもの。ポート（RDP: 3389, SSH: 22, HTTP: 80 等）の許可/拒否を設定。NIC または サブネットに関連付け可能。

---

## 2. Virtual Machine Scale Sets (VMSS)

**Virtual Machine Scale Sets (VMSS)** は、負荷分散された同一の VM のグループを作成・管理できるサービスです。
「負荷に応じて VM の台数を自動で増減させたい（オートスケーリング）」という要件があれば、VMSS を選択します。

### ✅ 基本機能
*   **オートスケーリング**: CPU 使用率やメモリ使用量、スケジュールのメトリクスに基づいて、VM インスタンスの数を自動的に増やす（スケールアウト）または減らす（スケールイン）ことができます。
*   **負荷分散**: Azure Load Balancer や Application Gateway と自動的に統合されます。
*   **高可用性**: 複数の可用性ゾーンにまたがって VM を展開できます。

### ⚙️ オーケストレーションモード
VMSS には2つのモードがあります。試験で問われる可能性があります。

1.  **Uniform (均一)**:
    *   すべての VM インスタンスが「同じイメージ、同じ構成」で作成されます。
    *   従来の VMSS の動作です。大量の VM を素早く展開するのに向いています。
2.  **Flexible (フレキシブル)**:
    *   通常の VM と同様に個々の VM を制御しながら、スケーリング機能を利用できます。
    *   **重要**: 耐障害性を高めるために、FD (障害ドメイン) を手動で分散させるような高度な構成が可能です。

### 🔄 更新ポリシー (Upgrade Policies)
OS イメージの更新やパッチ適用をどう行うかという設定です。

| ポリシー | 説明 |
| :--- | :--- |
| **手動 (Manual)** | 自動では行われません。管理者が手動で更新をトリガーする必要があります。**デフォルトの設定**です。 |
| **自動 (Automatic)** | Azure がタイミングを見て自動的に更新します。ダウンタイムが発生しないように順次行われます。 |
| **ローリング (Rolling)** | 更新をバッチ（グループ）に分けて順次適用します。「全体の 20% ずつ更新する」といった詳細な制御が可能です。 |

> [!WARNING]
> **引っ掛けポイント**
> 「VMSS を作成したが、OS イメージを更新してもインスタンスに反映されない。なぜか？」
> → 答え：更新ポリシーが**Manual (手動)** になっているからです。手動モードの場合、`Reimage` (再イメージ化) や `Upgrade` アクションを実行しない限り、既存の VM には変更が反映されません。

---

## 3. Azure App Service

**Azure App Service** は、Web アプリケーション、REST API、モバイルバックエンドをホストするための PaaS (Platform as a Service) です。
OS の管理（パッチ適用など）は Microsoft が行います。開発者はコードのデプロイに集中できます。

### 📦 App Service Plan (ASP)
App Service を動かすための「サーバーファーム（サーバーの集まり）」の定義です。**料金と機能**はここで決まります。
リージョンと OS (Windows/Linux) を指定します。

#### 主な価格帯 (SKU) と機能
試験では「この機能を使うにはどのプランが必要か？」が問われます。

| SKU (プラン) | 用途 | 特徴・制限 | デプロイスロット | VNet 統合 |
| :--- | :--- | :--- | :--- | :--- |
| **Free / Shared** | 趣味・学習 | 共有インフラ。SLA なし。カスタムドメイン可(Shared)。 | ❌ なし | ❌ 不可 |
| **Basic** | 小規模開発 | 専用インスタンス。SSL 対応。 | ❌ なし | ❌ 不可 |
| **Standard** | **本番環境 (小)** | オートスケール、バックアップ、スロット対応。 | ✅ あり (5) | ✅ 可能 |
| **Premium (V2/V3)** | **本番環境 (大)** | 高性能、大規模スケール、ゾーン冗長対応。 | ✅ あり (20) | ✅ 可能 |
| **Isolated** | 大規模・高隔離 | **App Service Environment (ASE)** 専用。VNet 内に閉域配置可能。 | ✅ あり | ✅ 可能 |

> [!TIP]
> **試験対策：最低要件の法則**
> *   「デプロイスロットを使いたい」→ 最小は **Standard**。
> *   「VNet 統合を使いたい（オンプレミスと接続したい）」→ 最小は **Standard**。
> *   「プライベートな環境で完全に隔離したい」→ **Isolated (ASE)**。

### 🚀 デプロイスロット (Deployment Slots)
本番環境（Production）とは別に、「Staging」などのスロットを作成し、そこで動作確認を行えます。
*   **スワップ (Swap)**: スロットと本番環境を瞬時に入れ替える機能。ダウンタイムなしでリリース可能（VIP スワップ）。
*   **トラフィック分割**: 「10% のユーザーだけ新しいスロットに流す」といったカナリアリリースが可能。

### 📈 スケーリング
*   **スケールアップ (Scale Up)**: プランのランクを上げる（例：Standard → Premium）。CPU/メモリを増強。
*   **スケールアウト (Scale Out)**: インスタンス数を増やす。負荷分散。
    *   **自動スケール**: CPU % やメモリ量に応じて自動で台数を増減。Standard 以上で利用可能。

---

## 4. Azure Container Instances (ACI)

**Azure Container Instances (ACI)** は、Azure 上でコンテナを実行するための最もシンプルで高速な方法です。「サーバーレスコンテナ」とも呼ばれます。

### ✅ 特徴とユースケース
*   **仮想マシン管理不要**: VM を立てたり管理したりする必要はありません。コンテナイメージ（Docker Image）を指定するだけで起動します。
*   **高速起動**: 数秒で起動可能。
*   **課金**: 秒単位の課金。
*   **ユースケース**:
    *   簡単なバッチ処理。
    *   開発・テスト環境。
    *   一時的なタスク（CI/CD ビルドエージェントなど）。
    *   オーケストレーション（管理機能）が不要な場合。

### 👥 コンテナグループ
ACI では、単一のホストマシン上で複数のコンテナをまとめて実行する「コンテナグループ」という概念があります。
*   これらはライフサイクル（起動・停止）、ローカルネットワーク、ストレージボリュームを共有します。
*   **サイドカーパターン**: メインのアプリコンテナの横に、ログ収集や監視用の補助コンテナを置く構成に適しています。

> [!CAUTION]
> **ACI の制限**
> ACI は「スケーリング」や「高度な負荷分散」、「自己修復（オートヒーリング）」などのオーケストレーション機能を持ちません。これらが必要な場合は、次に紹介する **AKS** を使用します。

---

## 5. Azure Kubernetes Service (AKS)

**Azure Kubernetes Service (AKS)** は、コンテナオーケストレーションツールである Kubernetes (K8s) のマネージドサービスです。
大量のコンテナを運用、自動スケーリング、自己修復させる場合はこちらを選択します。

### 🏗️ アーキテクチャ
AKS は「コントロールプレーン（管理機能）」と「ノード（実行環境）」に分かれています。

1.  **コントロールプレーン (Master Node)**:
    *   Microsoft が管理。**無料**です。（SLA 付きの Standard Tier を選ぶと有料）。
    *   API Server, Scheduler, etcd などが含まれます。
2.  **ノード (Worker Node)**:
    *   ユーザーのアプリケーションが動く VM。**有料**です（VM の料金がかかります）。
    *   **ノードプール**: 同じ構成の VM のグループ。Windows ノードプールと Linux ノードプールを混在させることも可能です。

### 📈 スケーリングの種類
試験でよく出る Kubernetes のスケーリング用語です。

*   **HPA (Horizontal Pod Autoscaler)**:
    *   Pod（コンテナ）の数を増やす。CPU 使用率などに基づいて自動化。
*   **Cluster Autoscaler**:
    *   Node（VM）の数を増やす。Pod を配置する場所が足りなくなったときに動作。
*   **ACI との連携 (Virtual Kubelet)**:
    *   急激なバーストアクセス時に、足りない分を ACI (Azure Container Instances) に逃がす構成が可能。これを **Virtual Nodes** と呼びます。

### 🔄 アップグレード
AKS クラスター（Kubernetes のバージョン）のアップグレードは Azure Portal や CLI から簡単に行えます。
*   **Cordon & Drain**: アップグレード中、Azure は自動的にノードを「Cordon（新規配置禁止）」し、「Drain（既存 Pod の追い出し）」を行ってから VM を更新します。これによりダウンタイムを最小限にします。

---

## 6. Azure Functions

**Azure Functions** は、イベントドリブン（イベント駆動型）のサーバーレスコンピューティングサービスです。
「何かが起きたら（トリガー）、コードを実行する」という仕組みです。

### ⚡ トリガーとバインディング
*   **トリガー (Trigger)**: 関数を実行させるきっかけ。
    *   例：HTTP リクエスト、タイマー（スケジュール）、Blob ストレージへのファイルアップロード、Service Bus キューのメッセージ着信。
*   **バインディング (Binding)**: データの入出力を簡単にする仕組み。
    *   コード内で DB 接続処理などを書かかなくても、設定だけで Cosmos DB 等にデータを書き込める（出力バインディング）。

### 💰 ホスティングプラン (Hosting Plans)
関数の実行環境と課金体系を決定します。**試験の超頻出ポイント**です。

| プラン | 課金 | 特徴・制限 | コールドスタート | VNet 統合 |
| :--- | :--- | :--- | :--- | :--- |
| **従量課金 (Consumption)** | 実行回数・時間 | 最も安い。自動スケール。**タイムアウト**（デフォルト5分、最大10分）。 | **あり** (発生する) | ❌ 不可 |
| **Premium (Elastic Premium)** | 固定費 (vCPU/メモリ) | 常にウォームスタンバイ（コールドスタートなし）。VNet 統合可能。実行時間無制限（60分保証）。 | **なし** | ✅ 可能 |
| **App Service Plan (Dedicated)** | VM 料金 | App Service (Web Apps) とリソースを共有したい場合に使用。 | なし | ✅ 可能 |

> [!IMPORTANT]
> **試験対策：どのプランを選ぶ？**
> *   「コストを最小限にしたい」→ **従量課金**。
> *   「10分以上かかる長い処理を実行したい」→ **Premium** または **Dedicated**。
> *   「VNet 内のリソースにアクセスしたい」→ **Premium** または **Dedicated**。
> *   「コールドスタート（最初の実行が遅い現象）を避けたい」→ **Premium** または **Dedicated**。

### ⏳ Durable Functions
ステートフル（状態を持つ）な関数を定義するための拡張機能です。
*   **オーケストレーター関数**: 複数の関数（アクティビティ）を順番に呼んだり、並列実行して結果を待ったりするワークフローをコードで記述できます。
*   **ファンアウト/ファンイン**: 1つの処理を複数に並列化し(Fan-out)、最後に集計する(Fan-in)パターンが得意。

---

## 📝 まとめ：コンピュートサービスの使い分けガイド

| 要件 | 推奨サービス |
| :--- | :--- |
| **OS の完全な制御が必要** / 既存アプリの移行 (Lift & Shift) | **Virtual Machines (VM)** |
| **負荷に応じて VM を自動増減**させたい | **VM Scale Sets (VMSS)** |
| **Web アプリ/API** を手軽に公開したい (PaaS) | **App Service** |
| **コンテナ**を最速で動かしたい / オーケストレーション不要 | **ACI (Container Instances)** |
| 大規模な**コンテナ**システム / K8s エコシステムを利用したい | **AKS (Kubernetes Service)** |
| **イベント**に反応して短時間のコードを実行したい / サーバーレス | **Azure Functions** |

---

 
 
# AZ-104 試験対策：ストレージサービス完全攻略ガイド

この記事は、Microsoft Azure Administrator (AZ-104) 認定試験対策として、**Azure Storage** 分野を徹底解説した学習資料です。
複雑になりがちな冗長性オプションや、Blob のアクセス層、ファイル同期ソリューションなどを、**初学者にもわかりやすく**図解的な表現で整理しています。

---

## 📖 目次

1. [Azure Storage Account の基礎](#1-azure-storage-account-基礎)
2. [データの冗長性 (Redundancy)](#2-データの冗長性-redundancy)
3. [セキュリティとアクセス制御](#3-セキュリティとアクセス制御)
4. [Azure Blob Storage](#4-azure-blob-storage)
5. [Azure Files & Azure File Sync](#5-azure-files--azure-file-sync)
6. [その他ストレージ (Queue, Table, Disk)](#6-その他ストレージ-queue-table-disk)
7. [データ転送ツール](#7-データ転送ツール)

---

## 1. Azure Storage Account の基礎

**Azure Storage Account** は、Azure の各種データサービス（Blob, File, Queue, Table）をまとめて管理するための「器（コンテナ）」です。

### 🔑 重要概念
*   **一意な名前**: ストレージアカウント名は、**Azure 全体（全世界）で一意**である必要があります。
    *   形式: 小文字の英数字のみ、3〜24文字。
    *   エンドポイント例: `https://<accountname>.blob.core.windows.net`
*   **アカウントの種類 (Account Kinds)**:
    *   **StorageV2 (General Purpose v2)**: **推奨**。最新機能（階層化、冗長性など）をすべてサポート。
    *   **Storage (General Purpose v1)**: レガシー。基本的には使用しないが、非常に古いシステムとの互換性で残っている。
    *   **BlobStorage**: レガシー。現在は StorageV2 を使用すべき。
    *   **BlockBlobStorage / FileStorage**: **Premium パフォーマンス**が必要な場合に選択する特殊なアカウント。

> [!TIP]
> **試験対策**
> 「最新の機能を使用し、コストを最適化したい」という要件があれば、迷わず **StorageV2 (General purpose v2)** を選択してください。V1 や BlobStorage を選ぶ理由は現在ほぼありません。

---

## 2. データの冗長性 (Redundancy)

データセンターの障害からデータを守るための仕組みです。**AZ-104 試験で最も出題される（そしてややこしい）分野**の一つです。
「どの障害まで耐えられるか」「クロスリージョンレプリケーション（地域間複製）はあるか」を表で覚えましょう。

### 🛡️ 冗長性オプション一覧

| オプション | 正式名称 (Full Name) | データのコピー数 | データの場所 | 耐障害性 |
| :--- | :--- | :--- | :--- | :--- |
| **LRS** | **Locally Redundant Storage**<br>(ローカル冗長ストレージ) | 3コピー | 1つのデータセンター内 | ラック/サーバー障害 |
| **ZRS** | **Zone-redundant Storage**<br>(ゾーン冗長ストレージ) | 3コピー | 同ーリージョン内の<br>**3つの可用性ゾーン** | データセンター障害<br>(火災・停電) |
| **GRS** | **Geo-redundant Storage**<br>(ジオ冗長ストレージ) | 6コピー | プライマリリージョン(LRS)<br>+ セカンダリリージョン(LRS) | **リージョン障害**<br>(大地震・洪水) |
| **GZRS** | **Geo-zone-redundant Storage**<br>(ジオゾーン冗長ストレージ) | 6コピー | プライマリリージョン(**ZRS**)<br>+ セカンダリリージョン(LRS) | データセンター障害 +<br>リージョン障害 |

### ⚠️ フェイルオーバーと読み取りアクセス

GRS や GZRS は、データを数百キロ離れた「ペアリージョン（例：東日本 ↔ 西日本）」にコピーします。しかし、デフォルトでは**セカンダリリージョンのデータにはアクセスできません**。

*   **セカンダリへのアクセス権**:
    *   通常時：プライマリのみ読み書き可能。
    *   障害時：Microsoft がフェイルオーバーを発動しない限り、セカンダリは読めない。
*   **RA-GRS / RA-GZRS (Read Access - ...)**:
    *   **重要**: オプション名の頭に `RA-` (Read Access) がつくと、**通常時でもセカンダリからデータの「読み取り」が可能**になります。
    *   書き込みは常にプライマリのみ。
    *   ユースケース：プライマリがダウンしても、セカンダリから読み取ることでサービスの稼働を継続したい場合。

> [!IMPORTANT]
> **試験の引っ掛けポイント：ZRS から GRS への変換**
> 既存のストレージアカウントのレプリケーション設定を変更する場合、**LRS ↔ GRS** は直接変更可能です。
> しかし、**LRS ↔ ZRS** の直接変更は（基本的には）できません。データの移行（コピー）が必要になるケースが多いです。（※一部リージョンでライブマイグレーションがサポートされ始めていますが、試験的には「ZRSへの変更は制約が多い」と覚えておくのが安全です。）

---

## 3. セキュリティとアクセス制御

ストレージへのアクセスを「誰に」「どのように」許可するか。3つの主要な方法があります。

### 🔑 1. アクセスキー (Storage Account Keys)
*   **概要**: 管理者権限（フルアクセス）を持つ2つの鍵（Key1, Key2）。
*   **リスク**: これが漏れると、すべてのデータを操作・削除できてしまうため、**アプリケーションへの埋め込みは非推奨**。
*   **運用**: 定期的に鍵をローテーション（交換）するために2つ用意されている。KeyVault に格納して管理するのがベストプラクティス。

### 🎫 2. 共有アクセス署名 (SAS: Shared Access Signature)
*   **概要**: アクセスキーを使わずに、**「期間」「権限」「IPアドレス」などを制限した一時的なアクセスURL**を発行する機能。
*   **試験頻出パラメータ**:
    *   **Allowed Services**: Blob, File, Queue, Table のどれを許可するか。
    *   **Allowed Resource Types**: Service(アカウント全体), Container(フォルダ), Object(ファイル)。
    *   **Allowed Permissions**: Read, Write, Delete, List, Add, Create, Update, Process。
    *   **Start/Expiry time**: 有効期限。
*   **ユーザー委任 SAS (User Delegation SAS)**:
    *   Entra ID (旧 Azure AD) の資格情報を使って署名する SAS。アカウントキーを使わないため、よりセキュア。

### 🆔 3. Microsoft Entra ID (旧 Azure AD) 認証
*   **概要**: ユーザーやマネージド ID に対して RBAC (ロールベースアクセス制御) で権限を割り当てる。**最も推奨される方法**。
*   **ロールの例**:
    *   **Storage Blob Data Owner**: コンテナ作成、データ読み書き、権限変更（フルアクセス）。
    *   **Storage Blob Data Contributor**: データの読み書きはできるが、権限変更はできない。
    *   **Storage Blob Data Reader**: データの読み取りのみ。

> [!CAUTION]
> **よくある間違い：Contributor (共同作成者) ロール**
> `Contributor` (Azure リソース自体の管理者) ロールを持っていても、**データプレーン（Blobの中身）へのアクセス権はありません**。
> 「ストレージアカウントの設定は変更できるが、Blob ファイルが見れない」というトラブルシュート問題の正解は、「**Storage Blob Data Contributor** ロールを付与する」です。

### 🌐 ネットワークセキュリティ
*   **ファイアウォール**: 指定した IP アドレス範囲または VNet からのみアクセスを許可。
*   **プライベートエンドポイント**: VNet 内にプライベート IP を持ち、インターネットを経由せずに閉域網でストレージにアクセスする技術。

---

## 4. Azure Blob Storage

**Azure Blob Storage** は、テキストやバイナリデータ（画像、動画、ログファイルなど）を大量に保存するためのオブジェクトストレージです。AWS S3 に相当します。

### 📦 構造
1.  **Storage Account**: 最上位の親。
2.  **Container**: フォルダのようなもの。Blob をグループ化。アクセス権設定の境界。
3.  **Blob**: 実際のファイル。

### 📊 アクセス層 (Access Tiers)
データの利用頻度に応じてコストを最適化するための設定です。**試験でのコスト計算・最適化問題の主役**です。

| アクセス層 | 用途 | ストレージ料金 | アクセス料金 | データの可用性 | 変更可能性 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Hot** (ホット) | 頻繁にアクセスされるデータ。<br>（Web画像、現在進行形のログ） | 高い | **安い** | 即時 | オンライン変更可 |
| **Cool** (クール) | **30日以上**保存。たまにしかアクセスしない。<br>（先月のバックアップ、古いプロジェクト） | 中くらい | 中くらい | 即時 | オンライン変更可 |
| **Cold** (コールド) | **90日以上**保存。Cool よりさらにアクセス頻度が低い。 | 安い | 高い | 即時 | オンライン変更可 |
| **Archive** (アーカイブ) | **180日以上**保存。滅多に使わない。<br>（法的保存義務のある数年前のログ） | **最安** | **最高** | **非オフライン**<br>(取り出しに時間がかかる) | **アクセス不可**<br>(リハイダレートが必要) |

> [!WARNING]
> **試験対策：アーカイブ層からの復元 (Rehydration)**
> Archive 層にあるデータは直接読み取れません。Hot または Cool 層に戻す「リハイダレート」操作が必要です。
> *   **標準 (Standard)**: 完了まで最大 **15時間**。安い。
> *   **優先 (High Priority)**: 完了まで **1時間以内**（通常数分）。高い。
> 「緊急でデータが必要になった！」というシナリオでは「優先」を選びます。

### 🔄 ライフサイクル管理 (Lifecycle Management)
「ルール」を作成して、自動的にアクセス層を移動させたり、削除したりする機能です。
*   例：「作成から30日経過したら Cool に移動」「1年経過したら Archive に移動」「7年経過したら削除」
*   **LastAccessTime (最終アクセス時間)**: 有効にすると、「最後に**読まれた**日」を基準に移動できます（デフォルトは「作成日」や「更新日」基準）。

### 🔒 不変ストレージ (Immutable Storage)
「WORM (Write Once, Read Many)」を実現する機能。一度書き込んだら、指定期間は**管理者であっても変更・削除ができなく**なります。
*   **時間ベースの保持ポリシー**: 指定した日数（例：365日）は削除不可。
*   **訴訟ホールド (Legal Hold)**: 明示的に解除されるまで、無期限に削除不可。

---

## 5. Azure Files & Azure File Sync

**Azure Files** は、フルマネージドのファイル共有サービスです。標準の **SMB プロトコル** (Windows/Mac/Linux) や **NFS** (Linux) でマウントできます。

### 💻 利用シナリオ
*   **Lift & Shift**: オンプレミスのファイルサーバーをそのままクラウドに移行したい。
*   **共有設定**: 複数の VM から同時に同じファイルを読み書きしたい。

### 🌲 オンプレミス AD DS 認証
Azure Files は、オンプレミスの Active Directory Domain Services (AD DS) と連携し、**Windows の ACL (アクセス制御リスト)** をそのまま利用できます。
*   これにより、オンプレミスのファイルサーバー移行時に、フォルダごとのアクセス権限設定を維持したまま移行可能です。

### 🔄 Azure File Sync
オンプレミスの Windows Server と Azure Files を同期させるハイブリッドソリューションです。

*   **仕組み**:
    *   オンプレミスのサーバーに「Azure File Sync エージェント」をインストール。
    *   Azure Files を「マスターコピー」として、オンプレミスサーバーを「キャッシュ」として扱います。
*   **クラウド階層化 (Cloud Tiering)**:
    *   **これが最大のメリット**。頻繁に使われるファイルだけをローカルサーバーに残し、使われないファイルは実体を Azure に送ってローカルからはポインタだけ残します（見た目はあるが、開くとダウンロードされる）。
    *   これにより、オンプレミスサーバーのディスク容量を節約できます。

---

## 6. その他ストレージ (Queue, Table, Disk)

### 📨 Queue Storage
*   **用途**: 大量のメッセージを保存するためのサービス。システム間の非同期通信に使用します。
*   **特徴**:
    *   シンプルな構造。
    *   **最大サイズ**: 1メッセージあたり 64 KB。
    *   **順序**: **FIFO（先入れ先出し）は保証されません**。
    *   より高度な機能（Pub/Sub、FIFO保証、トランザクション、256KB以上のメッセージ）が必要な場合は、**Azure Service Bus** を使用します。

### 📊 Table Storage
*   **用途**: NoSQL キーバリューストア。構造化された非リレーショナルデータを大量に保存。
*   **Cosmos DB との違い**:
    *   Table Storage は安価で単純。
    *   グローバル分散、低レイテンシ、マルチ API が必要な場合は **Cosmos DB** を選択します。

### 💿 Azure Disk Storage (Managed Disks)
VM にアタッチされる仮想ディスクです。コンピュートの章でも触れましたが、ストレージ観点での重要ポイントをまとめます。

*   **管理ディスク (Managed Disks)**:
    *   ユーザーは「ディスク」リソースだけを意識すればよく、裏側のストレージアカウント管理は不要。
    *   **冗長性**: LRS または ZRS のみ。（GRS は非対応。リージョンをまたぐ場合は Azure Backup や Site Recovery を使う）。
*   **暗号化**:
    *   **SSE (Server-Side Encryption)**: 保存時に自動暗号化。デフォルトで有効（Platform Managed Keys）。
    *   **ADE (Azure Disk Encryption)**: OS レベル（BitLocker / DM-Crypt）での暗号化。VM の処理能力を使う。

> [!TIP]
> **試験対策：スナップショットとバックアップ**
> *   **スナップショット**: 特定時点のディスクのコピー。差分バックアップではない（フルコピーに近い）。そのままでは VM として起動できず、ディスクを作成し直す必要がある。
> *   **Azure Backup**: 定期的なスケジュール、保持期間管理、整合性確保などが統合されたサービス。運用バックアップにはこちらを使う。

---

## 7. データ転送ツール

データを Azure に移行したり、データを操作したりするためのツールです。**AzCopy のコマンド**は試験に出ます。

### 📋 Azure Storage Explorer
GUI (Graphical User Interface) ツール。Windows, Mac, Linux で動作。
*   ストレージアカウント内のデータをエクスプローラーのように操作できる。
*   Blob のアップロード/ダウンロード/SAS発行などがマウス操作で可能。
*   エミュレータ (Azurite) に接続してローカル開発も可能。

### 💻 AzCopy
コマンドライン (CLI) ツール。**最高のパフォーマンス**でデータをコピー・同期するために最適化されています。

*   **基本構文**:
    ```bash
    azcopy copy '送り元(Source)' '送り先(Destination)' [flags]
    ```
*   **認証**:
    *   Entra ID 認証 (`azcopy login`)
    *   SAS トークン（URLの後ろに付与）
*   **同期 (Sync)**:
    ```bash
    azcopy sync 'ソース' 'デスティネーション' --delete-destination=true
    ```
    *   `sync` コマンドを使うと、変更があったファイルだけを転送（増分コピー）します。
    *   `--delete-destination=true` をつけると、**ソースにないファイルをデスティネーションから削除**します（ミラーリング）。

> [!IMPORTANT]
> **試験の引っ掛け：Import/Export サービス**
> 「数百 TB のデータを、インターネット回線が遅い環境から Azure に移行したい。どうするか？」
> → 答え：**Azure Import/Export サービス** (HDD を物理的に郵送する) または **Azure Data Box** を使用する。
> 「数 TB 程度で、回線はそこそこある」なら **AzCopy**。

---


